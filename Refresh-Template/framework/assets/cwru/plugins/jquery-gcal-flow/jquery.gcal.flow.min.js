(function(){var t,e,i,a,n,o,l,s,r;if(t=jQuery,i={},i.error=i.warn=i.log=i.info=i.debug=function(){},"undefined"!=typeof window&&null!==window&&"undefined"!=typeof console&&null!==console&&null!=console.log){if(!window._gCalFlow_quiet)for(r=["error","warn","info"],l=0,s=r.length;l<s;l++)o=r[l],i[o]=function(){return console[o]?console[o].apply(console,arguments):console.log.apply(console,arguments)};window._gCalFlow_debug&&(i.debug=function(){return null!=console.debug?console.debug.apply(console,arguments):console.log.apply(console,arguments)})}n=function(t,e){var i,a,n,o;if(null==e&&(e=2),10*(e-1)<=t)return t;for(a="",i=n=1,o=e-(""+t).length;1<=o?n<=o:n>=o;i=1<=o?++n:--n)a=a.concat("0");return a.concat(t)},e=function(){function e(t,e){this.target=t,t.addClass("gCalFlow"),t.children().size()>0&&(i.debug("Target node has children, use target element as template."),this.template=t),this.update_opts(e)}return e.demo_apikey="AIzaSyD0vtTUjLXzH4oKCzNRDymL6E3jKBympf0",e.prototype.target=null,e.prototype.template=t('<div class="gCalFlow">\n  <div class="gcf-header-block">\n    <div class="gcf-title-block">\n      <span class="gcf-title"></span>\n    </div>\n  </div>\n  <div class="gcf-item-container-block">\n    <div class="gcf-item-block">\n      <div class="gcf-item-header-block">\n        <div class="gcf-item-date-block">\n          [<span class="gcf-item-daterange"></span>]\n        </div>\n        <div class="gcf-item-title-block">\n          <strong class="gcf-item-title"></strong>\n        </div>\n      </div>\n      <div class="gcf-item-body-block">\n        <div class="gcf-item-description">\n        </div>\n        <div class="gcf-item-location">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="gcf-last-update-block">\n    LastUpdate: <span class="gcf-last-update"></span>\n  </div>\n</div>'),e.prototype.opts={maxitem:15,calid:"case.edu_gupalc7urm7b82taup5h7vge9s@group.calendar.google.com",apikey:e.demo_apikey,mode:"upcoming",feed_url:null,auto_scroll:!0,scroll_interval:1e4,link_title:!0,link_item_title:!0,link_item_description:!1,link_item_location:!1,link_target:"_blank",item_description_as_html:!1,callback:null,no_items_html:"<p>no events found</p>",globalize_fmt_datetime:"'<span class=\"month\">'MMM'</span><span class=\"day\">'dd'</span>'",globalize_fmt_date:"MMM",date_formatter:function(t,e){var i;if("undefined"!=typeof Globalize&&null!==Globalize&&null!=Globalize.format)return i=e?this.globalize_fmt_date:this.globalize_fmt_datetime,Globalize.format(t,i)},daterange_formatter:function(t,e,i){var a,o;return o=this.date_formatter(t),t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()||(a+="undefined"!=typeof Globalize&&null!==Globalize&&null!=Globalize.format?Globalize.format(e,this.globalize_fmt_monthday):""+n(e.getMonth()+1)+"/"+n(e.getDate())),o}},e.prototype.update_opts=function(e){return i.debug("update_opts was called"),i.debug("old options:",this.opts),this.opts=t.extend({},this.opts,e),i.debug("new options:",this.opts)},e.prototype.gcal_url=function(){var t;if(!this.opts.calid&&!this.opts.feed_url)throw i.error("Option calid and feed_url are missing. Abort URL generation"),this.target.text("Error: You need to set 'calid' or 'feed_url' option."),"gCalFlow: calid and feed_url missing";return this.opts.feed_url?this.opts.feed_url:"updates"===this.opts.mode?(t=(new Date).toJSON(),"https://www.googleapis.com/calendar/v3/calendars/"+this.opts.calid+"/events?key="+this.opts.apikey+"&maxResults="+this.opts.maxitem+"&orderBy=updated&timeMin="+t+"&singleEvents=true"):(t=(new Date).toJSON(),"https://www.googleapis.com/calendar/v3/calendars/"+this.opts.calid+"/events?key="+this.opts.apikey+"&maxResults="+this.opts.maxitem+"&orderBy=startTime&timeMin="+t+"&singleEvents=true")},e.prototype.fetch=function(){var e,a=this;return i.debug("Starting ajax call for "+this.gcal_url()),this.opts.apikey===this.constructor.demo_apikey&&(i.warn("You are using built-in demo API key! This key is provided for tiny use or demo only. Your access may be limited."),i.warn("Please check document and consider to use your own key.")),e=function(t){return i.debug("Ajax call success. Response data:",t),a.render_data(t,a)},t.ajax({type:"GET",success:e,dataType:"jsonp",url:this.gcal_url()})},e.prototype.parse_date=function(t){var e,a,n,o,l,s,r,d,c;return(n=t.match(/^(\d{4})-(\d{2})-(\d{2})$/))?new Date(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),0,0,0):(s=60*(new Date).getTimezoneOffset()*1e3,c=l=e=null,a=o=d=0,(n=t.match(/^(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|([+-])(\d{2}):(\d{2}))$/))?(c=parseInt(n[1],10),l=parseInt(n[2],10),e=parseInt(n[3],10),a=parseInt(n[4],10),o=parseInt(n[5],10),d=parseInt(n[6],10),s=60*new Date(c,l-1,e,a,o,d).getTimezoneOffset()*1e3,"Z"!==n[7]&&(s+=("+"===n[8]?1:-1)*(60*parseInt(n[9],10)+parseInt(n[10],10))*1e3*60),i.debug("time parse (gap to local): "+s),r=new Date(new Date(c,l-1,e,a,o,d).getTime()-s),i.debug("time parse: "+t+" -> ",r),r):(i.warn("Time parse error! Unknown time pattern: "+t),new Date(1970,1,1,0,0,0)))},e.prototype.render_data=function(e){var a,n,o,l,s,r,d,c,p,m,u,f,g,h,_,b,y,v,w,k;if(i.debug("start rendering for data:",e),_=this.template.clone(),b=null!=(w=this.opts.titlelink)?w:"http://www.google.com/calendar/embed?src="+this.opts.calid,this.opts.link_title?_.find(".gcf-title").html(t("<a />").attr({target:this.opts.link_target,href:b}).text(e.summary)):_.find(".gcf-title").text(e.summary),_.find(".gcf-link").attr({target:this.opts.link_target,href:b}),_.find(".gcf-last-update").html(this.opts.date_formatter(this.parse_date(e.updated))),p=_.find(".gcf-item-block"),p.detach(),p=t(p[0]),i.debug("item block template:",p),m=t(),i.debug("render entries:",e.items),n=this.opts.item_description_as_html?"html":"text",null!=e.items&&e.items.length>0)for(k=e.items.slice(0,+this.opts.maxitem+1||9e9),y=0,v=k.length;y<v;y++)l=k[y],i.debug("formatting entry:",l),a=p.clone(),l.start&&(g=l.start.dateTime?l.start.dateTime:l.start.date,f=this.parse_date(g),h=this.opts.date_formatter(f,g.indexOf(":")<0),a.find(".gcf-item-date").html(h),a.find(".gcf-item-start-date").html(h)),l.end&&(s=l.end.dateTime?l.end.dateTime:l.end.date,o=this.parse_date(s),r=this.opts.date_formatter(o,s.indexOf(":")<0),a.find(".gcf-item-end-date").html(r),a.find(".gcf-item-daterange").html(this.opts.daterange_formatter(f,o,g.indexOf(":")<0))),a.find(".gcf-item-update-date").html(this.opts.date_formatter(this.parse_date(l.updated),!1)),u=t("<a />").attr({target:this.opts.link_target,href:l.htmlLink}),this.opts.link_item_title?a.find(".gcf-item-title").html(u.clone().text(l.summary)):a.find(".gcf-item-title").text(l.summary),this.opts.link_item_description?a.find(".gcf-item-description").html(u.clone()[n](l.description)):a.find(".gcf-item-description")[n](l.description),this.opts.link_item_location?(d="<a href='https://maps.google.de/maps?q="+encodeURI(l.location.replace(" ","+"))+"' target='new'>"+l.location+"</a>",a.find(".gcf-item-location").html(d)):a.find(".gcf-item-location").text(l.location),a.find(".gcf-item-link").attr({href:l.htmlLink}),i.debug("formatted item entry:",a[0]),m.push(a[0]);else m=t('<div class="gcf-no-items"></div>').html(this.opts.no_items_html);if(i.debug("formatted item entry array:",m),c=_.find(".gcf-item-container-block"),i.debug("item container element:",c),c.html(m),this.target.html(_.html()),this.bind_scroll(),this.opts.callback)return this.opts.callback.apply(this.target)},e.prototype.bind_scroll=function(){var t,e,a,n,o;if(e=this.target.find(".gcf-item-container-block"),t=e.find(".gcf-item-block"),i.debug("scroll container:",e),!(!this.opts.auto_scroll||e.size()<1||t.size()<2))return o={idx:0},n=function(){var a;return i.debug("current scroll position:",e.scrollTop()),i.debug("scroll capacity:",e[0].scrollHeight-e[0].clientHeight),"undefined"==typeof t[o.idx]||e.scrollTop()>=e[0].scrollHeight-e[0].clientHeight?(i.debug("scroll to top"),o.idx=0,e.animate({scrollTop:t[0].offsetTop})):(a=t[o.idx].offsetTop,i.debug("scroll to "+a+"px"),e.animate({scrollTop:a}),o.idx+=1)},a=setInterval(n,this.opts.scroll_interval)},e}(),a={init:function(t){var i;if(null==t&&(t={}),i=this.data("gCalFlow"),!i)return this.data("gCalFlow",{target:this,obj:new e(this,t)})},destroy:function(){var e;return e=this.data("gCalFlow"),e.obj.target=null,t(window).unbind(".gCalFlow"),e.gCalFlow.remove(),this.removeData("gCalFlow")},render:function(){return"undefined"!=typeof Globalize&&null!==Globalize&&null!=Globalize.culture&&Globalize.culture(this.data("gCalFlow").obj.opts.globalize_culture),this.data("gCalFlow").obj.fetch()}},t.fn.gCalFlow=function(e){var i;return i=arguments,"object"!=typeof e&&e?a[e]?this.each(function(){return a[e].apply(t(this),Array.prototype.slice.call(i,1))}):"version"===e?"3.0.1":t.error("Method "+e+" does not exist on jQuery.gCalFlow"):this.each(function(){return a.init.apply(t(this),i),a.render.apply(t(this),i)})}}).call(this);